#!/usr/bin/env bash

# Wrapper script for spark-submit that finds Guacamole JARs and a Spark properties file.
#
# Example:
#
#   $ scripts/guacamole somatic-joint normal.bam tumor.bam --reference hg19.fasta --out out.vcf
#
# Default Spark-properties file is at conf/spark-defaults.conf, and configures a 4gb, 1-worker, local Spark master. To
# specify other Spark properties, set the $GUAC_CONF_PATH environment variable.

dir="$(dirname "${BASH_SOURCE[0]}")"

# Set uber_jar xor {guac_jar,deps_jar} and $conf_file
source "$dir/.jars-rc"

# Make jars_args an array that will be passed to spark-submit below.
jars_args=()
if [ -n "$uber_jar" ]; then
  jars_args=("$uber_jar")
else
  jars_args=("--jars" "$deps_jar" "$guac_jar")
fi

source "$dir/.spark-rc"

# Run Spark!
time "$SPARK_HOME"/bin/spark-submit --properties-file "$conf_file" "${jars_args[@]}" "$@"
